<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hoit.accountbook.mapper.AccountBookMapper">
	<select id="accountBookList" resultType="map">
		SELECT ACCOUNT_ID
			 , ASSET_ID
			 , CATEGORY_ID
			 , ACCOUNT_TYPE
			 , ACCOUNT_DATE
			 , AMOUNT
			 , DESCRIPTION
			 , CREATE_DT
		FROM T_ACCOUNT_BOOK
	</select>
	<select id="getCurrentMoney" resultType="map">
		SELECT ASSET_ID
			 , ASSET_TYPE
			 , CURRENT_BALANCE
		FROM T_ASSETS
	</select>
	<select id="accountBookCnt" resultType="map" parameterType="map">
		SELECT COUNT(*)
		FROM T_ACCOUNT_BOOK
	</select>
	
	<select id="getTotalAssets" resultType="map" parameterType="map">
		SELECT IFNULL(SUM(CHARGE_AMOUNT), 0) AS CHARGE_AMOUNT
		FROM T_ASSETS
		WHERE SUBSTR(ASSET_AT, 1, 7) = #{ASSET_AT}
	</select>
	
	<insert id="saveAsset" parameterType="map">
		INSERT INTO T_ASSETS
		(
			ASSET_ID
		  , ASSET_TYPE
		  , CURRENT_BALANCE
		  , ASSET_AT
		) VALUES (
			#{ASSET_ID}
		  , #{ASSET_TYPE}
		  , #{CURRENT_BALANCE}
		  , SYSDATE()
		);  
	</insert>
	<insert id="writeAccountBook" parameterType="map">
		INSERT INTO T_ACCOUNT_BOOK
		(
			ACCOUNT_ID
		  , ASSET_ID
		  , CATEGORY_ID
		  , ACCOUNT_TYPE
		  , ACCOUNT_DATE
		  , AMOUNT
	      , DESCRIPTION
		  , CREATE_DT
		) VALUE (
			#{ACCOUNT_ID}
		  , #{ASSET_ID}
		  , #{CATEGORY_ID}
		  , #{ACCOUNT_TYPE}
		  , DATE_FORMAT(NOW(), '%Y-%m-%d')
		  , #{AMOUNT}
		  , #{DESCRIPTION}
		  , NOW()
		);  
	</insert>
	<update id="renewAsset" parameterType="map">
		UPDATE T_ASSETS
		SET CURRENT_BALANCE = #{CURRENT_BALANCE}
		WHERE ASSET_ID = #{ASSET_ID};
	</update>
	<delete id="deleteAccountBook" parameterType="map">
		DELETE FROM T_ACCOUNT_BOOK
		WHERE ACCOUNT_ID = #{ACCOUNT_ID}
	</delete>
	<delete id="deleteAsset" parameterType="map">
		DELETE FROM T_ASSETS
		WHERE ASSET_ID = #{ASSET_ID}
	</delete>
	
</mapper>