<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hoit.accountbook.mapper.AccountBookMapper">
	<select id="accountBookList" resultType="map">
		SELECT ACCOUNT_ID
			 , CATEGORY_ID
			 , ACCOUNT_DATE
			 , USE_AMOUNT
			 , DESCRIPTION
			 , CREATE_DT
		FROM T_ACCOUNT_BOOK
	</select>
	<select id="getCurrentMoney" resultType="map">
		SELECT IFNULL(
			(
				SELECT CURRENT_BALANCE 
				FROM T_ASSETS 
				ORDER BY ASSET_AT DESC 
				LIMIT 1
			), 0) AS CURRENT_BALANCE
	</select>
	<select id="getSelectCommunity" resultType="map" parameterType="map">
	 	SELECT ACCOUNT_ID
			 , CATEGORY_ID
			 , ACCOUNT_DATE
			 , USE_AMOUNT
			 , DESCRIPTION
			 , CREATE_DT
		FROM T_ACCOUNT_BOOK
		WHERE ACCOUNT_ID = #{ACCOUNT_ID}
	</select>
	<select id="accountBookCnt" resultType="map" parameterType="map">
		SELECT COUNT(*)
		FROM T_ACCOUNT_BOOK
	</select>
	
	<select id="getTotalAssets" resultType="map" parameterType="map">
		SELECT IFNULL(SUM(CHARGE_AMOUNT), 0) AS CHARGE_AMOUNT
		FROM T_ASSETS
		WHERE SUBSTR(ASSET_AT, 1, 7) = #{ASSET_AT}
	</select>
	
	<insert id="chargeCash" parameterType="map">
		INSERT INTO T_ASSETS
		(
			ASSET_ID
		  , CHARGE_AMOUNT
		  , CURRENT_BALANCE
		  , ASSET_AT
		) VALUES (
			#{ASSET_ID}
		  , #{CHARGE_AMOUNT}
		  , #{CURRENT_BALANCE}
		  , SYSDATE()
		);  
	</insert>
	<insert id="writeAccountBook" parameterType="map">
		INSERT INTO T_ACCOUNT_BOOK
		(
			ACCOUNT_ID
		  , CATEGORY_ID
		  , ACCOUNT_DATE
		  , USE_AMOUNT
	      , DESCRIPTION
		  , CREATE_DT
		) VALUE (
			#{ACCOUNT_ID}
		  , #{CATEGORY_ID}
		  , DATE_FORMAT(NOW(), '%Y-%m-%d')
		  , #{USE_AMOUNT}
		  , #{DESCRIPTION}
		  , NOW()
		);  
	</insert>
	<update id="edieAccountBook" parameterType="map">
		UPDATE T_ACCOUNT_BOOK
		SET commu_title = #{commu_title}
		  , contents = #{contents}
		  , updated_datetime = NOW()
		  , updater_id = #{updater_id}
	</update>
	<update id="edieTotalMoney" parameterType="map">
		UPDATE T_ACCOUNT_BOOK
		SET TOTAL_MONEY = #{TOTAL_MONEY}
		WHERE ACCOUNT_ID = #{ACCOUNT_ID};
	</update>
	<delete id="deleteAccountBook" parameterType="map">
		DELETE FROM T_ACCOUNT_BOOK
		WHERE ACCOUNT_ID = #{ACCOUNT_ID}
	</delete>
</mapper>